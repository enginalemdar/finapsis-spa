<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Finapsis • Teknik Analiz</title>
  <script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
  <link rel="stylesheet" href="/styles.css">
</head>

<body>
<div class="wrap">
  <!-- Header - consistent with detail.html -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-6 gap-4">
    <div class="flex items-center gap-4">
      <div class="w-14 h-14 bg-[#0f0f0f] border border-[#2a2a2a] rounded-2xl flex items-center justify-center p-2 overflow-hidden">
        <img id="companyLogo" src="" alt="" class="w-full h-full object-contain hidden" />
        <i id="companyLogoFallback" class="fa-solid fa-chart-line text-2xl text-white"></i>
      </div>

      <div>
        <div class="flex items-center gap-2 mb-1">
          <span id="tickerPill" class="bg-[#1a2205] text-[#c2f50e] border border-[#c2f50e]/30 text-[10px] font-black px-2 py-0.5 rounded uppercase tracking-wide">-</span>
          
          <!-- View toggle badges -->
          <div class="flex gap-1">
            <button class="view-badge" data-view="temel" onclick="switchView('temel')">Temel</button>
            <button class="view-badge active" data-view="teknik" onclick="switchView('teknik')">Teknik</button>
          </div>
          
          <!-- Menu icon -->
          <button id="tickerMenuBtn" class="w-7 h-7 rounded flex items-center justify-center hover:bg-white/5 transition-colors">
            <i class="fa-solid fa-ellipsis-vertical text-sm text-[#8a8a8a]"></i>
          </button>
        </div>
        <h1 id="companyTitle" class="text-2xl font-extrabold text-white tracking-tight leading-tight">Teknik Analiz</h1>
        <div id="companyMeta" class="text-xs text-[#8a8a8a] font-semibold mt-1">-</div>
      </div>
    </div>

    <div class="flex flex-col items-end gap-3 w-full md:w-auto">
      <!-- Search -->
      <div class="flex items-center gap-2 search-wrap">
        <input id="tickerSearch" class="search-input" placeholder="Şirket ara (ticker / isim)" autocomplete="off" />
        <div id="searchDD" class="search-dd"></div>
      </div>

      <!-- Lookback badge (popup) -->
      <div class="relative">
        <button id="lookbackBtn" class="px-3 py-1.5 bg-[#0f0f0f] border border-[#2a2a2a] rounded text-xs font-bold text-white hover:bg-[#1a1a1a] transition-colors">
          <i class="fa-solid fa-clock text-[10px] mr-1.5"></i>
          <span id="lookbackLabel">400</span>
        </button>
        <div id="lookbackPopup" class="absolute right-0 mt-1 bg-[#0f0f0f] border border-[#2a2a2a] rounded-lg shadow-xl p-2 hidden min-w-[160px] z-50">
          <button class="w-full text-left px-3 py-2 text-xs font-semibold text-white hover:bg-[#1a1a1a] rounded transition-colors" data-lookback="400">400 Gün</button>
          <button class="w-full text-left px-3 py-2 text-xs font-semibold text-white hover:bg-[#1a1a1a] rounded transition-colors" data-lookback="800">800 Gün</button>
          <button class="w-full text-left px-3 py-2 text-xs font-semibold text-white hover:bg-[#1a1a1a] rounded transition-colors" data-lookback="1200">1200 Gün</button>
          <button class="w-full text-left px-3 py-2 text-xs font-semibold text-white hover:bg-[#1a1a1a] rounded transition-colors" data-lookback="2500">2500 Gün</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
    <!-- Left Panel (4 cols) -->
    <div class="lg:col-span-4 flex flex-col gap-6">
      <div class="fin-card p-5">
        <div class="text-[#8a8a8a] text-xs font-extrabold uppercase tracking-widest mb-4">Özet</div>

        <div class="flex justify-between items-start mb-4">
          <div>
            <div class="text-[#6b6b6b] text-[10px] font-black uppercase">Ticker</div>
            <div class="text-2xl font-extrabold text-white" id="sumTicker">—</div>
            <div class="text-xs text-[#8a8a8a] mt-1">AsOf: <span id="sumAsOf">—</span></div>
          </div>
          <div class="signalBadge" id="sumSignal"><span class="dot"></span> —</div>
        </div>

        <div class="border-t border-white/5 pt-4 mt-4">
          <div class="text-[#6b6b6b] text-[10px] font-black uppercase mb-2">Skor</div>
          <div class="flex justify-between items-center mb-2">
            <div class="text-xl font-extrabold text-white"><span id="sumScore">—</span> <span class="text-[#8a8a8a]">/ 100</span></div>
            <div class="text-xs text-[#8a8a8a]" id="sumMomRisk">—</div>
          </div>
          <div class="flex items-center gap-2">
            <div class="flex-1 h-2 bg-[#0f0f0f] border border-white/10 rounded-full overflow-hidden">
              <div id="scoreBar" class="h-full bg-gradient-to-r from-[#c2f50e]/20 to-[#c2f50e]" style="width:0%"></div>
            </div>
            <div class="text-xs text-[#6b6b6b] min-w-[40px] text-right">0-100</div>
          </div>
        </div>

        <div class="border-t border-white/5 pt-4 mt-4">
          <div class="flex justify-between items-start">
            <div>
              <div class="text-[#6b6b6b] text-[10px] font-black uppercase">Son Kapanış</div>
              <div class="text-xl font-extrabold text-white" id="sumClose">—</div>
              <div class="text-xs text-[#8a8a8a] mt-1">Hacim: <span id="sumVol">—</span></div>
            </div>
            <div class="signalBadge" id="sumTrend"><span class="dot"></span> Trend: —</div>
          </div>
        </div>

        <div class="border-t border-white/5 pt-4 mt-4">
          <div class="flex justify-between items-start">
            <div>
              <div class="text-[#6b6b6b] text-[10px] font-black uppercase">RSI(14)</div>
              <div class="text-xl font-extrabold text-white" id="sumRSI">—</div>
              <div class="text-xs text-[#8a8a8a] mt-1">Vol/Ort20: <span id="sumVolVs">—</span></div>
            </div>
            <div class="min-w-[120px]">
              <div class="h-2 bg-[#0f0f0f] border border-white/10 rounded-full overflow-hidden">
                <div id="rsiBar" class="h-full bg-gradient-to-r from-[#c2f50e]/20 to-[#c2f50e]" style="width:0%"></div>
              </div>
              <div class="text-xs text-[#6b6b6b] text-right mt-1">0-100</div>
            </div>
          </div>
        </div>

        <div class="border-t border-white/5 pt-4 mt-4">
          <div class="text-[#6b6b6b] text-[10px] font-black uppercase mb-2">Seviyeler</div>
          <div class="text-xs text-[#d9d9d9]" id="sumLevels">—</div>
        </div>
      </div>
    </div>

    <!-- Right Panel (8 cols) -->
    <div class="lg:col-span-8 flex flex-col gap-6">
      <div class="fin-card p-5">
        <div class="flex justify-between items-center mb-4">
          <div class="text-[#8a8a8a] text-xs font-extrabold uppercase tracking-widest">Grafik</div>
          
          <!-- Legend -->
          <div id="legend" class="flex gap-2 flex-wrap">
            <span class="legend-pill" data-key="ema20"><span class="dot green"></span> EMA20</span>
            <span class="legend-pill" data-key="ema50"><span class="dot amber"></span> EMA50</span>
            <span class="legend-pill" data-key="volume"><span class="dot"></span> Hacim</span>
            <span class="legend-pill" data-key="sr"><span class="dot"></span> S/R</span>
            <span class="legend-pill" data-key="user"><span class="dot"></span> User</span>
          </div>
        </div>

        <div class="chartWrap" id="chartWrap">
          <div class="tv-tooltip" id="tooltip">
            <div class="tdate" id="ttDate">—</div>
            <div class="row"><span>Açılış</span><b id="ttO">—</b></div>
            <div class="row"><span>Yüksek</span><b id="ttH">—</b></div>
            <div class="row"><span>Düşük</span><b id="ttL">—</b></div>
            <div class="row"><span>Kapanış</span><b id="ttC">—</b></div>
            <div class="row"><span>Hacim</span><b id="ttV">—</b></div>
          </div>
        </div>

        <div class="text-[#8a8a8a] text-xs font-extrabold uppercase tracking-widest mt-4 mb-2">Etiketler & Uyarılar</div>
        <div id="tags" class="flex flex-wrap gap-2"></div>
        <div id="alerts" class="mt-4"></div>

        <div id="err" class="text-red-500 text-sm mt-4"></div>
      </div>
    </div>
  </div>
</div>

<!-- Ticker Menu Popup (same as companies) -->
<div id="tickerMenuPopup" class="fixed hidden z-50 bg-[#0f0f0f] border border-[#2a2a2a] rounded-lg shadow-2xl min-w-[180px]">
  <div class="p-2">
    <button class="w-full text-left px-3 py-2 text-xs font-semibold text-white hover:bg-[#1a1a1a] rounded transition-colors flex items-center gap-2">
      <i class="fa-solid fa-arrow-trend-up text-green-500"></i>
      <span>AL</span>
    </button>
    <button class="w-full text-left px-3 py-2 text-xs font-semibold text-white hover:bg-[#1a1a1a] rounded transition-colors flex items-center gap-2">
      <i class="fa-solid fa-arrow-trend-down text-red-500"></i>
      <span>SAT</span>
    </button>
    <button class="w-full text-left px-3 py-2 text-xs font-semibold text-white hover:bg-[#1a1a1a] rounded transition-colors flex items-center gap-2">
      <i class="fa-solid fa-bell text-[#c2f50e]"></i>
      <span>Alarm Kur</span>
    </button>
    <button class="w-full text-left px-3 py-2 text-xs font-semibold text-white hover:bg-[#1a1a1a] rounded transition-colors flex items-center gap-2">
      <i class="fa-solid fa-chart-line text-blue-500"></i>
      <span>Portföye Ekle</span>
    </button>
  </div>
</div>

<script src="/technic.js"></script>
</body>
</html>

<style>
.view-badge {
  padding: 4px 10px;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 4px;
  color: #8a8a8a;
  font-size: 10px;
  font-weight: 800;
  cursor: pointer;
  transition: all 0.2s;
  text-transform: uppercase;
}

.view-badge.active {
  background: rgba(194,245,14,0.12);
  border-color: rgba(194,245,14,0.4);
  color: #c2f50e;
}

.signalBadge {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.1);
  background: rgba(0,0,0,0.35);
  font-size: 11px;
  color: #eaeaea;
  white-space: nowrap;
}

.dot {
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: rgba(255,255,255,0.35);
}

.dot.lime { background: #c2f50e; }
.dot.green { background: #31c48d; }
.dot.amber { background: #ffd166; }
.dot.red { background: #ff4d4d; }

.legend-pill {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 5px 10px;
  border-radius: 999px;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.08);
  font-size: 11px;
  color: #a3a3a3;
  cursor: pointer;
  transition: all 0.2s;
}

.legend-pill:hover {
  background: rgba(255,255,255,0.06);
}

.legend-pill.off {
  opacity: 0.45;
  filter: saturate(0.5);
}

.chartWrap {
  height: 640px;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,0.06);
  overflow: hidden;
  background: #070707;
  position: relative;
}

.tv-tooltip {
  position: absolute;
  z-index: 20;
  pointer-events: none;
  background: rgba(0,0,0,0.7);
  border: 1px solid rgba(255,255,255,0.1);
  backdrop-filter: blur(8px);
  border-radius: 14px;
  padding: 10px 12px;
  color: #eaeaea;
  min-width: 220px;
  box-shadow: 0 14px 26px rgba(0,0,0,0.45);
  transform: translate(-50%, -120%);
  display: none;
}

.tv-tooltip .tdate {
  font-size: 12px;
  color: #a3a3a3;
  margin-bottom: 6px;
}

.tv-tooltip .row {
  display: flex;
  justify-content: space-between;
  gap: 10px;
  font-size: 12px;
  line-height: 1.55;
}

.tv-tooltip .row b {
  font-weight: 750;
}

.tag {
  display: inline-flex;
  align-items: center;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.1);
  background: rgba(255,255,255,0.02);
  color: #d9d9d9;
  font-size: 11px;
}

.alert {
  margin-top: 12px;
  background: rgba(0,0,0,0.28);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 16px;
  padding: 14px;
}

.alertHead {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 8px;
}

.alertTitle {
  font-size: 16px;
  font-weight: 750;
}

.sev {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.1);
  background: rgba(255,255,255,0.03);
  font-size: 11px;
}

.sev.low .dot { background: rgba(255,255,255,0.35); }
.sev.medium .dot { background: #ffd166; }
.sev.high .dot { background: #ff4d4d; }

.alertText {
  font-size: 13px;
  color: #d9d9d9;
  line-height: 1.55;
}

.alertHint {
  font-size: 12px;
  color: #a3a3a3;
  margin-top: 6px;
}
</style>
</head>

<div id="app">
  <div class="left-panel">
    <div class="header-bar">
      <div style="font-weight:700; font-size:18px; display:flex; align-items:center; gap:10px;">
         Finapsis Sanal Portföy
      </div>
    </div>
    <div class="search-box" id="pfSearchBox">
        <i class="fa-solid fa-search search-icon"></i>
        <input type="text" id="searchInput" placeholder="Hisse, Döviz, Emtia ara." oninput="pfRenderMarketList()">
        
        <button class="pf-filter-btn" id="pfSectorBtn" title="Sektör Filtrele" onclick="pfToggleSectorPopup(event)">
            <i class="fa-solid fa-filter"></i>
        </button>

        <div class="pf-sector-popup" id="pfSectorPopup" style="display:none;">
            <div class="pf-sector-head">
              <div class="pf-sector-title">Sektör</div>
              <div class="pf-sector-actions">
                <button class="pf-sector-clear" onclick="pfClearSectorFilter(event)">Temizle</button>
                <i class="fa-solid fa-xmark pf-sector-close" onclick="pfCloseSectorPopup(event)"></i>
              </div>
            </div>
            <div style="padding: 8px; border-bottom:1px solid rgba(255,255,255,0.1);">
                <input type="text" id="pfSectorSearchInput" placeholder="Sektör ara..." 
                       style="width:100%; background:#1a1a1a; border:1px solid #333; color:#fff; padding:8px 10px; border-radius:8px; font-size:12px; outline:none; font-weight:600;" 
                       oninput="pfFilterSectorList(this.value)" onclick="event.stopPropagation()">
            </div>
            <div class="pf-sector-list" id="pfSectorList"></div>
        </div>
    </div>

    <div class="category-menu">
      <div class="cat-item active" onclick="pfSetGroup('bist', this)">BIST</div>
      <div class="cat-item" onclick="pfSetGroup('nyse', this)">NYSE</div>
      <div class="cat-item" onclick="pfSetGroup('nasdaq', this)">NASDAQ</div>
      <div class="cat-item" onclick="pfSetGroup('doviz', this)">Döviz</div>
      <div class="cat-item" onclick="pfSetGroup('emtia', this)">Emtia</div>
      <div class="cat-item" onclick="pfSetGroup('kripto', this)">Kripto</div>
    </div>
    <div class="market-list" id="marketList"></div>
  </div>
  <div class="right-panel" id="mainPanel"></div>
</div>

<div class="modal-overlay" id="tradeModal">
  <div class="trade-modal">
    <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
      <h3 style="margin:0;">İşlem Emri</h3>
      <i class="fa-solid fa-xmark" style="cursor:pointer; color:#666;" onclick="pfCloseTradeModal()"></i>
    </div>

    <select id="modalPortfolioSelect" class="portfolio-select" style="min-width:100%; width:100%; margin-bottom:12px; display:none;" onchange="pfSetTradePortfolio(this.value)"></select>

    <div style="display:flex; background:#000; padding:4px; border-radius:12px; margin-bottom:15px;">
      <div id="tabBuy" class="trade-tab-btn" onclick="pfUserClickSide('buy')">AL</div>
      <div id="tabSell" class="trade-tab-btn" onclick="pfUserClickSide('sell')">SAT</div>
    </div>

    <div style="display:flex; background:#000; padding:4px; border-radius:12px; margin-bottom:25px; border:1px solid #222;">
      <div id="modeQty" class="trade-tab-btn" onclick="pfSetInputMode('qty')">MİKTAR</div>
      <div id="modeAmt" class="trade-tab-btn" onclick="pfSetInputMode('amount')">TUTAR</div>
    </div>

    <div style="display:flex; align-items:center; gap:15px; margin-bottom:25px;">
      <img id="modalImg" src="" style="width:48px; height:48px; background:#fff; border-radius:10px; padding:4px;">
      <div>
        <div id="modalTicker" style="font-weight:800; font-size:20px;">-</div>
        <div id="modalPrice" style="font-size:16px; color:var(--primary); font-weight:600;">-</div>
      </div>
    </div>

    <div style="font-size:12px; color:#888; text-align:right; margin-bottom:6px;" id="modalLimit">-</div>
    <input type="number" id="tradeQty" class="form-input" placeholder="Miktar..." oninput="pfCalcTotal()">
    <div id="tradeHint" style="font-size:11px; color:#666; margin:-6px 0 12px 0; text-align:right;"></div>

    <div style="display:flex; justify-content:space-between; padding:15px; background:#000; border-radius:12px; margin-bottom:20px; border:1px solid #222;">
      <span style="color:#888; font-size:13px;">Tahmini Tutar</span>
      <div style="text-align:right;">
        <span id="tradeTotal" style="font-weight:700; font-size:15px; display:block;">0.00</span>
        <span id="tradeTotalTry" style="font-size:11px; color:#666; display:block;"></span>
      </div>
    </div>
    <button id="btnConfirmTrade" class="btn btn-primary" style="width:100%;" disabled onclick="pfSubmitTrade()">EMRİ GÖNDER</button>
  </div>
</div>

<div class="modal-overlay" id="transferModal">
  <div class="trade-modal">
    <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
      <h3 style="margin:0;">Virman</h3>
      <i class="fa-solid fa-xmark" style="cursor:pointer; color:#666;" onclick="pfCloseTransferModal()"></i>
    </div>

    <div style="font-size:12px; color:#888; margin-bottom:6px;">Kaynak Portföy</div>
    <select id="trFrom" class="portfolio-select" style="min-width:100%; width:100%; margin-bottom:12px;" onchange="pfOnTransferFromChange(this.value)"></select>

    <div style="font-size:12px; color:#888; margin-bottom:6px;">Hedef Portföy</div>
    <select id="trTo" class="portfolio-select" style="min-width:100%; width:100%; margin-bottom:12px;"></select>

    <div style="font-size:12px; color:#888; margin-bottom:6px;">Enstrüman</div>
    <select id="trTicker" class="portfolio-select" style="min-width:100%; width:100%; margin-bottom:12px;" onchange="pfUpdateTransferLimit()"></select>

    <div style="font-size:12px; color:#888; margin-bottom:6px; text-align:right;" id="trLimit">-</div>
    <input type="number" id="trQty" class="form-input" placeholder="Miktar giriniz..." oninput="pfValidateTransfer()">

    <button id="btnConfirmTransfer" class="btn btn-primary" style="width:100%;" disabled onclick="pfSubmitTransfer()">VİRMAN YAP</button>
    <button class="btn" style="width:100%; background:#222; color:#fff; margin-top:10px;" onclick="pfCloseTransferModal()">İptal</button>
  </div>
</div>

<div class="modal-overlay" id="pfHistModal">
  <div class="hist-modal">
    <div class="hist-head">
      <div>
        <div id="pfHistTitle" class="hist-title">-</div>
        <div id="pfHistSub" class="hist-sub">-</div>
      </div>
      <i class="fa-solid fa-xmark hist-close" onclick="pfCloseHistoryModal()"></i>
    </div>
    <div class="hist-body">
      <div id="pfHistLoading" class="hist-loading">Yükleniyor...</div>
      <canvas id="pfHistCanvas"></canvas>
    </div>
  </div>
</div>